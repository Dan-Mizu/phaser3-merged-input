!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("MergedInput",[],t):"object"==typeof exports?exports.MergedInput=t():e.MergedInput=t()}(window,function(){return r={},n.m=i=[function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],r=!0,n=!1,a=void 0;try{for(var o,s=e[Symbol.iterator]();!(r=(o=s.next()).done)&&(i.push(o.value),!t||i.length!==t);r=!0);}catch(e){n=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(n)throw a}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")},r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n=function(e,t,i){return t&&a(e.prototype,t),i&&a(e,i),e};function a(e,t){for(var i=0;i<t.length;i++){var r=t[i];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var o=(function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(s,Phaser.Plugins.ScenePlugin),n(s,[{key:"boot",value:function(){if(this.eventEmitter=this.systems.events,this.eventEmitter.on("update",this.update,this),void 0!==this.systems.input.gamepad&&(this.systems.input.gamepad.once("connected",function(e){this.setupGamepad(e)},this),this.gamepads=this.systems.input.gamepad.gamepads,this.systems.input.gamepad.refreshPads(),this.systems.input.gamepad.total)){var e=!0,t=!1,i=void 0;try{for(var r,n=this.systems.input.gamepad.gamepads[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;this.systems.input.gamepad.emit("connected",a)}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}this.systems.input.keyboard.on("keydown",function(t){var e=Object.keys(Phaser.Input.Keyboard.KeyCodes).find(function(e){return Phaser.Input.Keyboard.KeyCodes[e]===t.keyCode}),i=this.getPlayerIndexFromKey(e);-1<i&&(this.getPlayer(i).interaction.device="keyboard")},this),this.systems.input.keyboard.on("keyup",function(){var e=Object.keys(Phaser.Input.Keyboard.KeyCodes).find(function(e){return Phaser.Input.Keyboard.KeyCodes[e]===event.keyCode}),t=this.getPlayerIndexFromKey(e);-1<t&&(this.getPlayer(t).interaction.device="keyboard")},this),this.systems.input.mouse.disableContextMenu(),this.systems.input.on("pointermove",function(e){this.pointerMove(e)},this),this.systems.input.on("pointerdown",function(e){this.pointerDown(e)},this),this.systems.input.on("pointerup",function(e){this.pointerUp(e)},this)}},{key:"update",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.players[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;""==a.interaction.buffer&&(a.interaction.pressed=""),""!=a.interaction.pressed&&(a.interaction.buffer=""),a.pointer.BEARING=void 0!==a.pointer.BEARING?a.pointer.BEARING:"",a.pointer.BEARING_DEGREES=void 0!==a.pointer.BEARING_DEGREES?a.pointer.BEARING_DEGREES:"",a.pointer.ANGLE=void 0!==a.pointer.ANGLE?a.pointer.ANGLE:"",a.direction.BEARING=this.mapDirectionsToBearing(a.direction),a.direction.BEARING_LAST=""!=a.direction.BEARING?a.direction.BEARING:a.direction.BEARING_LAST,a.direction.DEGREES=""!=a.direction.BEARING?parseFloat(this.mapBearingToDegrees(a.direction.BEARING)):0,a.direction.DEGREES_LAST=""!=a.direction.BEARING_LAST?parseFloat(this.mapBearingToDegrees(a.direction.BEARING_LAST)):0,a.direction_secondary.BEARING=this.mapDirectionsToBearing(a.direction_secondary),a.direction_secondary.BEARING_LAST=""!=a.direction_secondary.BEARING?a.direction_secondary.BEARING:a.direction_secondary.BEARING_LAST,a.direction_secondary.DEGREES=""!=a.direction_secondary.BEARING?parseFloat(this.mapBearingToDegrees(a.direction_secondary.BEARING)):0,a.direction_secondary.DEGREES_LAST=""!=a.direction_secondary.BEARING_LAST?parseFloat(this.mapBearingToDegrees(a.direction_secondary.BEARING_LAST)):0}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}this.checkKeyboardInput(),this.checkGamepadInput(),this.checkPointerInput()}},{key:"setupGamepad",value:function(e){e.on("down",this.gamepadButtonDown,this),e.on("up",this.gamepadButtonUp,this),this.eventEmitter.emit("mergedInput",{device:"gamepad",id:e.id,player:e.index,action:"Connected"}),void 0===this.players[e.index]&&this.addPlayer(),this.players[e.index].gamepad=e}},{key:"addPlayer",value:function(e){return r(Number.isInteger(e))&&void 0!==this.players[e]?this.players[e]:(this.players.push(this.setupControls()),this.players[this.players.length-1].index=this.players.length-1,this.players[this.players.length-1])}},{key:"getPlayer",value:function(e){return void 0!==this.players[e]?this.players[e]:""}},{key:"getPlayerIndexFromKey",value:function(e){var t=!0,i=!1,r=void 0;try{for(var n,a=this.players[Symbol.iterator]();!(t=(n=a.next()).done);t=!0){var o=n.value;for(var s in o.keys){var d=!0,p=!1,c=void 0;try{for(var u,y=o.keys[s][Symbol.iterator]();!(d=(u=y.next()).done);d=!0)if(u.value==e)return o.index}catch(e){p=!0,c=e}finally{try{!d&&y.return&&y.return()}finally{if(p)throw c}}}}}catch(e){i=!0,r=e}finally{try{!t&&a.return&&a.return()}finally{if(i)throw r}}return-1}},{key:"setupControls",value:function(){for(var e={direction:{UP:0,DOWN:0,LEFT:0,RIGHT:0,BEARING:"",BEARING_LAST:"",DEGREES:0,DEGREES_LAST:0},direction_secondary:{UP:0,DOWN:0,LEFT:0,RIGHT:0,BEARING:"",DEGREES:0,BEARING_LAST:"",DEGREES_LAST:0},buttons:{},pointer:{M1:0,M2:0,M3:0,M4:0,M5:0,BEARING:"",BEARING_DEGREES:0,ANGLE:0},position:{},interaction:{},gamepad:{},keys:{UP:[],DOWN:[],LEFT:[],RIGHT:[]}},t=1;t<=16;t++)e.buttons["B"+t]=0,e.keys["B"+t]=[];return e.interaction.buffer="",e.interaction.pressed="",e.interaction.last="",e.interaction.device="",e}},{key:"defineKey",value:function(e,t,i,r){var n=0<arguments.length&&void 0!==e?e:0,a=t,o=i,s=3<arguments.length&&void 0!==r&&r;return void 0===this.players[n]&&this.addPlayer(),["UP","DOWN","LEFT","RIGHT","B0","B1","B2","B3","B4","B5","B6","B7","B8","B9","B10","B11","B12","B13","B14","B15","B16"].includes(a)&&(s||(this.players[n].keys[a]=[]),this.players[n].keys[a].push([o]),this.keys[[o]]=this.systems.input.keyboard.addKey(Phaser.Input.Keyboard.KeyCodes[o])),this}},{key:"checkKeyboardInput",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.players.entries()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=v(r.value,2),o=a[0],s=a[1];for(var d in s.keys){var p=0,c=!0,u=!1,y=void 0;try{for(var l,h=s.keys[d][Symbol.iterator]();!(c=(l=h.next()).done);c=!0){var f=l.value;p=this.keys[f].isDown?1:p,Phaser.Input.Keyboard.JustDown(this.keys[f])&&(this.eventEmitter.emit("mergedInput",{device:"keyboard",value:1,player:o,action:d,state:"DOWN"}),s.interaction.pressed=d,s.interaction.buffer=d,s.interaction.last=d),Phaser.Input.Keyboard.JustUp(this.keys[f])&&this.eventEmitter.emit("mergedInput",{device:"keyboard",value:1,player:o,action:d,state:"UP"})}}catch(e){u=!0,y=e}finally{try{!c&&h.return&&h.return()}finally{if(u)throw y}}["UP","DOWN","LEFT","RIGHT"].includes(d)?s.direction[d]=p:s.buttons[d]=p,1==p&&(s.interaction.device="keyboard")}}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"checkPointerInput",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.players.entries()[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=v(r.value,2),o=(a[0],a[1]);for(var s in o.keys){var d=!0,p=!1,c=void 0;try{for(var u,y=o.keys[s][Symbol.iterator]();!(d=(u=y.next()).done);d=!0){var l=u.value;["M1","M2","M3","M4","M5"].includes(l[0])&&1==this.players[0].pointer[l]&&(o.buttons[s]=1)}}catch(e){p=!0,c=e}finally{try{!d&&y.return&&y.return()}finally{if(p)throw c}}}}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"gamepadButtonDown",value:function(e,t,i){this.players[i.pad.index].interaction.device="gamepad",this.eventEmitter.emit("mergedInput",{device:"gamepad",value:t,player:i.pad.index,action:"B"+e,state:"DOWN"}),12===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"UP",state:"DOWN"}),13===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"DOWN",state:"DOWN"}),14===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"LEFT",state:"DOWN"}),15===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"RIGHT",state:"DOWN"}),[12,13,14,15].includes(e)||(this.players[i.pad.index].interaction.pressed="B"+e,this.players[i.pad.index].interaction.last="B"+e,this.players[i.pad.index].interaction.buffer="B"+e)}},{key:"gamepadButtonUp",value:function(e,t,i){this.players[i.pad.index].interaction.device="gamepad",this.eventEmitter.emit("mergedInput",{device:"gamepad",value:t,player:i.pad.index,action:"B"+e,state:"UP"}),12===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"UP",state:"UP"}),13===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"DOWN",state:"UP"}),14===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"LEFT",state:"UP"}),15===e&&this.eventEmitter.emit("mergedInput",{device:"gamepad",value:1,player:i.pad.index,action:"RIGHT",state:"UP"})}},{key:"checkGamepadInput",value:function(){var e=!0,t=!1,i=void 0;try{for(var r,n=this.gamepads[Symbol.iterator]();!(e=(r=n.next()).done);e=!0){var a=r.value;if(a.leftStick.y<-.5?this.players[a.index].direction.UP=Math.abs(a.leftStick.y):.5<a.leftStick.y?this.players[a.index].direction.DOWN=a.leftStick.y:"gamepad"===this.players[a.index].interaction.device&&(this.players[a.index].direction.UP=a.up?1:0,this.players[a.index].direction.DOWN=a.down?1:0),a.leftStick.x<-.5?this.players[a.index].direction.LEFT=Math.abs(a.leftStick.x):.5<a.leftStick.x?this.players[a.index].direction.RIGHT=a.leftStick.x:"gamepad"===this.players[a.index].interaction.device&&(this.players[a.index].direction.LEFT=a.left?1:0,this.players[a.index].direction.RIGHT=a.right?1:0),a.rightStick.y<-.5?this.players[a.index].direction_secondary.UP=Math.abs(a.rightStick.y):.5<a.rightStick.y?this.players[a.index].direction_secondary.DOWN=a.rightStick.y:(this.players[a.index].direction_secondary.UP=0,this.players[a.index].direction_secondary.DOWN=0),a.rightStick.x<-.5?this.players[a.index].direction_secondary.LEFT=Math.abs(a.rightStick.x):.5<a.rightStick.x?this.players[a.index].direction_secondary.RIGHT=a.rightStick.x:(this.players[a.index].direction_secondary.LEFT=0,this.players[a.index].direction_secondary.RIGHT=0),"gamepad"===this.players[a.index].interaction.device)for(var o=0;o<a.buttons.length;o++){var s=a.buttons[o];this.players[a.index].buttons["B"+o]=s.value}}}catch(e){t=!0,i=e}finally{try{!e&&n.return&&n.return()}finally{if(t)throw i}}}},{key:"pointerMove",value:function(e,t){if(t=t||0,e.distance>t&&(this.getBearingFromAngle(e.angle,8),void 0!==this.players[0]&&"undefined"!==this.players[0].position.x)){var i=this.players[0].position,r=Phaser.Math.Angle.Between(i.x,i.y,e.worldX,e.worldY),n=this.getBearingFromAngle(r,8),a=this.mapBearingToDegrees(n);this.players[0].pointer.BEARING=n,this.players[0].pointer.ANGLE=r,this.players[0].pointer.BEARING_DEGREES=a}}},{key:"pointerDown",value:function(e){var t="";this.players[0].interaction.device="pointer",e.leftButtonDown()&&(t="M1"),e.rightButtonDown()&&(t="M2"),e.middleButtonDown()&&(t="M3"),e.backButtonDown()&&(t="M4"),e.forwardButtonDown()&&(t="M5"),this.eventEmitter.emit("mergedInput",{device:"pointer",value:1,player:0,action:t,state:"DOWN"}),this.players[0].pointer[t]=1,this.players[0].interaction.pressed=t,this.players[0].interaction.last=t,this.players[0].interaction.buffer=t}},{key:"pointerUp",value:function(e){var t="";e.leftButtonReleased()&&(t="M1"),e.rightButtonReleased()&&(t="M2"),e.middleButtonReleased()&&(t="M3"),e.backButtonReleased()&&(t="M4"),e.forwardButtonReleased()&&(t="M5"),this.eventEmitter.emit("mergedInput",{device:"pointer",value:1,player:0,action:t,state:"UP"}),this.players[0].pointer[t]=0}},{key:"getBearingFromAngle",value:function(e,t,i){t=t||8;var r=Phaser.Math.PI2/t,n=Phaser.Math.Snap.To(e,r),a=Phaser.Math.RadToDeg(n);return this.bearings[a]}},{key:"mapBearingToDirections",value:function(e){var t={UP:0,DOWN:0,LEFT:0,RIGHT:0,BEARING:e.toUpperCase()};return e.toUpperCase().includes("W")&&(t.LEFT=1),e.toUpperCase().includes("E")&&(t.RIGHT=1),e.toUpperCase().includes("S")&&(t.DOWN=1),e.toUpperCase().includes("N")&&(t.UP=1),t}},{key:"mapDirectionsToBearing",value:function(e,t){return!e.UP||e.LEFT||e.RIGHT?e.RIGHT&&e.UP?"NE":!e.RIGHT||e.UP||e.DOWN?e.RIGHT&&e.DOWN?"SE":!e.DOWN||e.LEFT||e.RIGHT?e.LEFT&&e.DOWN?"SW":!e.LEFT||e.UP||e.DOWN?e.LEFT&&e.UP?"NW":"":"W":"S":"E":"N"}},{key:"mapBearingToDegrees",value:function(t){var i=this;return""!=t?Object.keys(this.bearings).find(function(e){return i.bearings[e]===t}):""}},{key:"destroy",value:function(){this.shutdown(),this.scene=void 0}},{key:"debug",value:function(){var e={input:{}};e.input.gamepads=[];for(var t=0;t<this.gamepads.length;t++){for(var i=this.gamepads[t],r={},n={},a=0;a<i.buttons.length;a++){var o=i.buttons[a];r["B"+o.index]=o.value}for(var s=0;s<i.axes.length;s++){var d=i.axes[s];n["A"+d.index]=d.getValue()}e.input.gamepads.push({ID:i.id,Index:i.index,Buttons:r,Axes:n})}var p=!0,c=!(e.players=[]),u=void 0;try{for(var y,l=this.players[Symbol.iterator]();!(p=(y=l.next()).done);p=!0){var h=y.value;e.players.push({interaction:h.interaction,device:h.device,buttons:h.buttons,pointer:h.pointer,direction:h.direction,direction_secondary:h.direction_secondary,keys:h.keys})}}catch(e){c=!0,u=e}finally{try{!p&&l.return&&l.return()}finally{if(c)throw u}}return e}}]),s);function s(e,t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,s);var i=function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(s.__proto__||Object.getPrototypeOf(s)).call(this,e,t));return i.scene=e,i.players=[],i.gamepads=[],i.keys={},i.bearings={"-180":"W","-168.75":"WBN","-157.5":"WNW","-146.25":"NWBW","-135":"NW","-123.75":"NWBN","-112.5":"NNW","-101.25":"NBW","-90":"N","-78.75":"NBE","-67.5":"NNE","-56.25":"NEBN","-45":"NE","-33.75":"NEBE","-22.5":"EBE","-11.25":"EBN",0:"E",11.25:"EBS",22.5:"ESE",33.75:"SEBE",45:"SE",56.25:"SEBS",67.5:"SSE",78.75:"SBE",90:"S",101.25:"SBW",112.5:"SSW",123.75:"SWBS",135:"SW",146.25:"SWBW",157.5:"WSW",168.75:"WBS",180:"W"},i}t.default=o}],n.c=r,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)n.d(i,r,function(e){return t[e]}.bind(null,r));return i},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=0);function n(e){if(r[e])return r[e].exports;var t=r[e]={i:e,l:!1,exports:{}};return i[e].call(t.exports,t,t.exports,n),t.l=!0,t.exports}var i,r});
//# sourceMappingURL=MergedInput.min.map